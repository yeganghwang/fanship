services:
  api:
    build:
      context: ./fanship-backend
      dockerfile: Dockerfile
    image: ${DOCKER_REGISTRY}/fanship-backend:latest
    container_name: fanship-api
    restart: unless-stopped
    env_file:
      - backend.env
    ports:
      - "3001:3000"

  frontend:
    build:
      context: ./fanship-frontend
      dockerfile: Dockerfile
      args:
        REACT_APP_API_BASE_URL: ${REACT_APP_API_BASE_URL}
        REACT_APP_SERVER_URL: ${REACT_APP_SERVER_URL}
        REACT_APP_RECAPTCHA_SITE_KEY: ${REACT_APP_RECAPTCHA_SITE_KEY}
    image: ${DOCKER_REGISTRY}/fanship-frontend:latest
    container_name: fanship-frontend
    restart: unless-stopped
  # runtime env_file removed: CRA variables come from root .env at build time.
    depends_on:
      - api
    ports:
      - "3002:80"

networks:
  default:
    driver: bridge
